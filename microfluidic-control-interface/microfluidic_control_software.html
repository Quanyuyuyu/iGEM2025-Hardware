<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微流控测试平台控制软件</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <!-- 配置Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        success: '#52C41A',
                        warning: '#FAAD14',
                        danger: '#FF4D4F',
                        dark: '#1F2329',
                        'light-bg': '#F5F7FA'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .device-card {
                @apply bg-white rounded-lg shadow-md p-4 transition-all duration-300 hover:shadow-lg;
            }
            .status-indicator {
                @apply w-3 h-3 rounded-full inline-block mr-2;
            }
            .control-btn {
                @apply px-4 py-2 rounded-md text-white font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2;
            }
            .panel {
                @apply bg-white rounded-lg shadow-sm p-5 h-full;
            }
            .btn-active {
                @apply transform scale-95 transition-transform duration-100;
            }
            .parameter-input {
                @apply w-full border border-gray-300 rounded-md px-2 py-1 text-sm focus:border-primary focus:ring-1 focus:ring-primary transition-all;
            }
            .modal-backdrop {
                @apply fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4;
            }
            .modal {
                @apply bg-white rounded-lg shadow-xl w-full max-w-md p-6 transform transition-all;
            }
            .notification {
                @apply fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full;
            }
        }
    </style>
</head>
<body class="bg-light-bg text-dark min-h-screen overflow-x-hidden">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-sm fixed top-0 left-0 right-0 z-10">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <i class="fa fa-flask text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-primary">微流控测试平台</h1>
            </div>
            
            <div class="flex items-center space-x-6">
                <button id="emergency-stop" class="text-danger hover:bg-danger hover:text-white px-3 py-1 rounded transition-colors">
                    <i class="fa fa-exclamation-triangle mr-1"></i>紧急停止
                </button>
                <button class="text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-cog"></i>
                </button>
                <button class="text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-question-circle"></i>
                </button>
                <div class="flex items-center">
                    <img src="https://picsum.photos/id/237/32/32" alt="用户头像" class="w-8 h-8 rounded-full mr-2">
                    <span>iGEM团队</span>
                </div>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 pt-20 pb-10">
        <!-- 状态概览 -->
        <section class="mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">系统状态</h2>
                <div class="flex items-center">
                    <span class="text-sm text-gray-500 mr-2">最后更新:</span>
                    <span class="text-sm" id="last-update">2023-05-15 14:30:22</span>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="device-card border-l-4 border-primary">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-medium">液体传输系统</h3>
                            <p class="text-sm text-gray-500 mt-1">泵 × 3 | 阀门 × 8</p>
                        </div>
                        <span class="bg-green-100 text-success text-xs px-2 py-1 rounded-full flex items-center">
                            <span class="status-indicator bg-success animate-pulse"></span>正常运行
                        </span>
                    </div>
                </div>
                
                <div class="device-card border-l-4 border-secondary">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-medium">检测系统</h3>
                            <p class="text-sm text-gray-500 mt-1">光谱仪 × 1 | 成像模块 × 1</p>
                        </div>
                        <span class="bg-green-100 text-success text-xs px-2 py-1 rounded-full flex items-center">
                            <span class="status-indicator bg-success animate-pulse"></span>正常运行
                        </span>
                    </div>
                </div>
                
                <div class="device-card border-l-4 border-warning">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-medium">当前任务</h3>
                            <p class="text-sm text-gray-500 mt-1">实验ID: EXP-20230515-002</p>
                        </div>
                        <span class="bg-blue-100 text-primary text-xs px-2 py-1 rounded-full flex items-center">
                            <i class="fa fa-spinner fa-spin mr-1"></i>进行中
                        </span>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 主要控制区域 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 左侧：设备控制 -->
            <div class="lg:col-span-2 space-y-6">
                <!-- 液体传输控制 -->
                <section>
                    <h2 class="text-xl font-semibold mb-4">液体传输控制</h2>
                    <div class="panel">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- 泵控制 -->
                            <div>
                                <h3 class="font-medium mb-3 flex items-center">
                                    <i class="fa fa-tint text-primary mr-2"></i>
                                    泵控制
                                </h3>
                                
                                <div class="space-y-4">
                                    <!-- 泵1 -->
                                    <div class="border border-gray-200 rounded-lg p-3" id="pump-1">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="font-medium">泵1 (蛋白液)</span>
                                            <span class="flex items-center text-success text-sm" id="pump-1-status">
                                                <span class="status-indicator bg-success"></span>
                                                就绪
                                            </span>
                                        </div>
                                        
                                        <div class="grid grid-cols-2 gap-3 mb-3">
                                            <div>
                                                <label class="block text-xs text-gray-500 mb-1">流量 (μL/min)</label>
                                                <input type="number" class="parameter-input" id="pump-1-flow" value="50" min="0" max="1000">
                                            </div>
                                            <div>
                                                <label class="block text-xs text-gray-500 mb-1">时间 (s)</label>
                                                <input type="number" class="parameter-input" id="pump-1-time" value="10" min="1" max="3600">
                                            </div>
                                        </div>
                                        
                                        <div class="flex space-x-2">
                                            <button class="control-btn bg-primary flex-1 pump-start" data-pump="1">
                                                <i class="fa fa-play mr-1"></i>启动
                                            </button>
                                            <button class="control-btn bg-gray-500 flex-1 pump-stop" data-pump="1" disabled>
                                                <i class="fa fa-stop mr-1"></i>停止
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- 泵2 -->
                                    <div class="border border-gray-200 rounded-lg p-3" id="pump-2">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="font-medium">泵2 (缓冲液A)</span>
                                            <span class="flex items-center text-success text-sm" id="pump-2-status">
                                                <span class="status-indicator bg-success"></span>
                                                就绪
                                            </span>
                                        </div>
                                        
                                        <div class="grid grid-cols-2 gap-3 mb-3">
                                            <div>
                                                <label class="block text-xs text-gray-500 mb-1">流量 (μL/min)</label>
                                                <input type="number" class="parameter-input" id="pump-2-flow" value="30" min="0" max="1000">
                                            </div>
                                            <div>
                                                <label class="block text-xs text-gray-500 mb-1">时间 (s)</label>
                                                <input type="number" class="parameter-input" id="pump-2-time" value="15" min="1" max="3600">
                                            </div>
                                        </div>
                                        
                                        <div class="flex space-x-2">
                                            <button class="control-btn bg-primary flex-1 pump-start" data-pump="2">
                                                <i class="fa fa-play mr-1"></i>启动
                                            </button>
                                            <button class="control-btn bg-gray-500 flex-1 pump-stop" data-pump="2" disabled>
                                                <i class="fa fa-stop mr-1"></i>停止
                                            </button>
                                        </div>
                                    </div>

                                    <!-- 泵3 -->
                                    <div class="border border-gray-200 rounded-lg p-3" id="pump-3">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="font-medium">泵3 (缓冲液B)</span>
                                            <span class="flex items-center text-success text-sm" id="pump-3-status">
                                                <span class="status-indicator bg-success"></span>
                                                就绪
                                            </span>
                                        </div>
                                        
                                        <div class="grid grid-cols-2 gap-3 mb-3">
                                            <div>
                                                <label class="block text-xs text-gray-500 mb-1">流量 (μL/min)</label>
                                                <input type="number" class="parameter-input" id="pump-3-flow" value="40" min="0" max="1000">
                                            </div>
                                            <div>
                                                <label class="block text-xs text-gray-500 mb-1">时间 (s)</label>
                                                <input type="number" class="parameter-input" id="pump-3-time" value="20" min="1" max="3600">
                                            </div>
                                        </div>
                                        
                                        <div class="flex space-x-2">
                                            <button class="control-btn bg-primary flex-1 pump-start" data-pump="3">
                                                <i class="fa fa-play mr-1"></i>启动
                                            </button>
                                            <button class="control-btn bg-gray-500 flex-1 pump-stop" data-pump="3" disabled>
                                                <i class="fa fa-stop mr-1"></i>停止
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 阀门控制 -->
                            <div>
                                <h3 class="font-medium mb-3 flex items-center">
                                    <i class="fa fa-exchange text-primary mr-2"></i>
                                    阀门控制
                                </h3>
                                
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="border border-gray-200 rounded-lg p-3 text-center valve-control" data-valve="1">
                                        <span class="block text-sm mb-2">阀门1</span>
                                        <div class="flex justify-center space-x-2 mb-2">
                                            <button class="px-3 py-1 bg-success text-white text-xs rounded valve-toggle" data-state="open">开</button>
                                            <button class="px-3 py-1 bg-gray-200 text-gray-700 text-xs rounded valve-toggle" data-state="close">关</button>
                                        </div>
                                        <span class="text-xs text-gray-500">通向芯片入口A</span>
                                    </div>
                                    
                                    <div class="border border-gray-200 rounded-lg p-3 text-center valve-control" data-valve="2">
                                        <span class="block text-sm mb-2">阀门2</span>
                                        <div class="flex justify-center space-x-2 mb-2">
                                            <button class="px-3 py-1 bg-gray-200 text-gray-700 text-xs rounded valve-toggle" data-state="open">开</button>
                                            <button class="px-3 py-1 bg-danger text-white text-xs rounded valve-toggle" data-state="close">关</button>
                                        </div>
                                        <span class="text-xs text-gray-500">通向芯片入口B</span>
                                    </div>
                                    
                                    <div class="border border-gray-200 rounded-lg p-3 text-center valve-control" data-valve="3">
                                        <span class="block text-sm mb-2">阀门3</span>
                                        <div class="flex justify-center space-x-2 mb-2">
                                            <button class="px-3 py-1 bg-gray-200 text-gray-700 text-xs rounded valve-toggle" data-state="open">开</button>
                                            <button class="px-3 py-1 bg-danger text-white text-xs rounded valve-toggle" data-state="close">关</button>
                                        </div>
                                        <span class="text-xs text-gray-500">通向废液槽</span>
                                    </div>
                                    
                                    <div class="border border-gray-200 rounded-lg p-3 text-center valve-control" data-valve="4">
                                        <span class="block text-sm mb-2">阀门4</span>
                                        <div class="flex justify-center space-x-2 mb-2">
                                            <button class="px-3 py-1 bg-success text-white text-xs rounded valve-toggle" data-state="open">开</button>
                                            <button class="px-3 py-1 bg-gray-200 text-gray-700 text-xs rounded valve-toggle" data-state="close">关</button>
                                        </div>
                                        <span class="text-xs text-gray-500">检测通道</span>
                                    </div>

                                    <div class="border border-gray-200 rounded-lg p-3 text-center valve-control" data-valve="5">
                                        <span class="block text-sm mb-2">阀门5</span>
                                        <div class="flex justify-center space-x-2 mb-2">
                                            <button class="px-3 py-1 bg-gray-200 text-gray-700 text-xs rounded valve-toggle" data-state="open">开</button>
                                            <button class="px-3 py-1 bg-danger text-white text-xs rounded valve-toggle" data-state="close">关</button>
                                        </div>
                                        <span class="text-xs text-gray-500">清洗通道</span>
                                    </div>

                                    <div class="border border-gray-200 rounded-lg p-3 text-center valve-control" data-valve="6">
                                        <span class="block text-sm mb-2">阀门6</span>
                                        <div class="flex justify-center space-x-2 mb-2">
                                            <button class="px-3 py-1 bg-gray-200 text-gray-700 text-xs rounded valve-toggle" data-state="open">开</button>
                                            <button class="px-3 py-1 bg-danger text-white text-xs rounded valve-toggle" data-state="close">关</button>
                                        </div>
                                        <span class="text-xs text-gray-500">缓冲液B通道</span>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <button id="preset-paths" class="w-full py-2 border border-primary text-primary rounded-md hover:bg-primary hover:text-white transition-colors">
                                        <i class="fa fa-random mr-1"></i>预设通路模式
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- 检测控制 -->
                <section>
                    <h2 class="text-xl font-semibold mb-4">检测控制</h2>
                    <div class="panel">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- 光谱检测 -->
                            <div>
                                <h3 class="font-medium mb-3 flex items-center">
                                    <i class="fa fa-line-chart text-secondary mr-2"></i>
                                    光谱检测
                                </h3>
                                
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium mb-1">检测波长范围</label>
                                        <div class="flex items-center space-x-2">
                                            <input type="number" class="parameter-input" id="spectra-start" value="400" placeholder="起始 (nm)" min="300" max="1000">
                                            <span>-</span>
                                            <input type="number" class="parameter-input" id="spectra-end" value="700" placeholder="结束 (nm)" min="300" max="1000">
                                        </div>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium mb-1">检测模式</label>
                                        <select class="parameter-input" id="spectra-mode">
                                            <option value="absorbance">吸光度</option>
                                            <option value="fluorescence">荧光</option>
                                            <option value="transmittance">透射率</option>
                                        </select>
                                    </div>

                                    <div class="mb-4">
                                        <label class="block text-sm font-medium mb-1">检测间隔 (s)</label>
                                        <input type="number" class="parameter-input" id="spectra-interval" value="5" min="1" max="300">
                                    </div>
                                    
                                    <button id="start-spectra" class="w-full control-btn bg-secondary">
                                        <i class="fa fa-search mr-1"></i>开始光谱检测
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 成像检测 -->
                            <div>
                                <h3 class="font-medium mb-3 flex items-center">
                                    <i class="fa fa-camera text-secondary mr-2"></i>
                                    成像检测
                                </h3>
                                
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium mb-1">成像参数</label>
                                        <div class="grid grid-cols-2 gap-2">
                                            <div>
                                                <label class="block text-xs text-gray-500 mb-1">曝光时间 (ms)</label>
                                                <input type="number" class="parameter-input" id="camera-exposure" value="50" min="1" max="1000">
                                            </div>
                                            <div>
                                                <label class="block text-xs text-gray-500 mb-1">放大倍数</label>
                                                <select class="parameter-input" id="camera-magnification">
                                                    <option value="10x">10x</option>
                                                    <option value="20x" selected>20x</option>
                                                    <option value="40x">40x</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3 bg-gray-100 h-32 rounded flex items-center justify-center overflow-hidden" id="camera-preview">
                                        <img src="" alt="实时图像预览" class="w-full h-full object-contain hidden" id="preview-image">
                                        <span class="text-gray-400 text-sm" id="preview-placeholder">实时图像预览区域</span>
                                    </div>
                                    
                                    <button id="capture-image" class="w-full control-btn bg-secondary">
                                        <i class="fa fa-camera mr-1"></i>捕获图像
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- 实验流程 -->
                <section>
                    <h2 class="text-xl font-semibold mb-4">实验流程设计</h2>
                    <div class="panel">
                        <div class="flex justify-between items-center mb-4">
                            <div>
                                <h3 class="font-medium">当前流程: 蛋白反应检测</h3>
                                <p class="text-sm text-gray-500">包含 5 个步骤 | 预计时长: 15分钟</p>
                            </div>
                            <div class="flex space-x-2">
                                <button id="save-process" class="text-primary text-sm hover:underline">
                                    <i class="fa fa-save mr-1"></i>保存流程
                                </button>
                                <button id="load-process" class="text-primary text-sm hover:underline">
                                    <i class="fa fa-folder-open mr-1"></i>加载流程
                                </button>
                            </div>
                        </div>
                        
                        <!-- 流程步骤 -->
                        <div class="space-y-3 mb-4" id="process-steps">
                            <div class="flex items-center p-3 bg-blue-50 border border-blue-100 rounded-md">
                                <div class="w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-xs mr-3">1</div>
                                <div class="flex-1">
                                    <div class="font-medium text-sm">注入蛋白液</div>
                                    <div class="text-xs text-gray-500">泵1 | 50μL/min | 10秒</div>
                                </div>
                                <div class="flex space-x-1">
                                    <button class="text-gray-400 hover:text-primary edit-step" data-step="1">
                                        <i class="fa fa-pencil"></i>
                                    </button>
                                    <button class="text-gray-400 hover:text-danger delete-step" data-step="1">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="flex items-center p-3 bg-blue-50 border border-blue-100 rounded-md">
                                <div class="w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-xs mr-3">2</div>
                                <div class="flex-1">
                                    <div class="font-medium text-sm">注入缓冲液A</div>
                                    <div class="text-xs text-gray-500">泵2 | 30μL/min | 15秒</div>
                                </div>
                                <div class="flex space-x-1">
                                    <button class="text-gray-400 hover:text-primary edit-step" data-step="2">
                                        <i class="fa fa-pencil"></i>
                                    </button>
                                    <button class="text-gray-400 hover:text-danger delete-step" data-step="2">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="flex items-center p-3 bg-gray-50 border border-gray-200 rounded-md">
                                <div class="w-6 h-6 bg-gray-400 text-white rounded-full flex items-center justify-center text-xs mr-3">3</div>
                                <div class="flex-1">
                                    <div class="font-medium text-sm">混合反应</div>
                                    <div class="text-xs text-gray-500">静置 | 5分钟</div>
                                </div>
                                <div class="flex space-x-1">
                                    <button class="text-gray-400 hover:text-primary edit-step" data-step="3">
                                        <i class="fa fa-pencil"></i>
                                    </button>
                                    <button class="text-gray-400 hover:text-danger delete-step" data-step="3">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="flex items-center p-3 bg-gray-50 border border-gray-200 rounded-md">
                                <div class="w-6 h-6 bg-gray-400 text-white rounded-full flex items-center justify-center text-xs mr-3">4</div>
                                <div class="flex-1">
                                    <div class="font-medium text-sm">光谱检测</div>
                                    <div class="text-xs text-gray-500">400-700nm | 吸光度</div>
                                </div>
                                <div class="flex space-x-1">
                                    <button class="text-gray-400 hover:text-primary edit-step" data-step="4">
                                        <i class="fa fa-pencil"></i>
                                    </button>
                                    <button class="text-gray-400 hover:text-danger delete-step" data-step="4">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="flex items-center p-3 bg-gray-50 border border-gray-200 rounded-md">
                                <div class="w-6 h-6 bg-gray-400 text-white rounded-full flex items-center justify-center text-xs mr-3">5</div>
                                <div class="flex-1">
                                    <div class="font-medium text-sm">成像检测</div>
                                    <div class="text-xs text-gray-500">20x | 50ms曝光</div>
                                </div>
                                <div class="flex space-x-1">
                                    <button class="text-gray-400 hover:text-primary edit-step" data-step="5">
                                        <i class="fa fa-pencil"></i>
                                    </button>
                                    <button class="text-gray-400 hover:text-danger delete-step" data-step="5">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button id="add-step" class="flex-1 py-2 border border-primary text-primary rounded-md hover:bg-primary hover:text-white transition-colors">
                                <i class="fa fa-plus mr-1"></i>添加步骤
                            </button>
                            <button id="run-process" class="flex-1 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors">
                                <i class="fa fa-play mr-1"></i>运行流程
                            </button>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- 右侧：监测与结果 -->
            <div class="space-y-6">
                <!-- 实时监测 -->
                <section>
                    <h2 class="text-xl font-semibold mb-4">实时监测</h2>
                    <div class="panel">
                        <div class="mb-4">
                            <h3 class="font-medium mb-2">反应进度</h3>
                            <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                                <div class="bg-primary h-2.5 rounded-full transition-all duration-1000" id="progress-bar" style="width: 35%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span id="current-step">步骤2/5</span>
                                <span id="remaining-time">预计剩余: 9分钟</span>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h3 class="font-medium mb-2">实时数据</h3>
                            <div class="h-48">
                                <canvas id="realtimeChart"></canvas>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="font-medium mb-2">系统日志</h3>
                            <div class="bg-gray-50 rounded-md h-40 p-3 overflow-y-auto text-sm text-gray-600 text-left text-xs" id="system-log">
                                <p><span class="text-gray-400">[14:28:15]</span> 系统启动完成</p>
                                <p><span class="text-gray-400">[14:28:30]</span> 加载实验流程: 蛋白反应检测</p>
                                <p><span class="text-gray-400">[14:29:05]</span> 泵1启动: 50μL/min, 10秒</p>
                                <p><span class="text-gray-400">[14:29:15]</span> 泵1已停止</p>
                                <p><span class="text-gray-400">[14:29:20]</span> 泵2启动: 30μL/min, 15秒</p>
                                <p><span class="text-gray-400">[14:29:35]</span> 泵2已停止</p>
                                <p><span class="text-gray-400">[14:29:36]</span> 开始混合反应，等待5分钟</p>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- 检测结果 -->
                <section>
                    <h2 class="text-xl font-semibold mb-4">检测结果</h2>
                    <div class="panel">
                        <div class="mb-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="font-medium">最新光谱数据</h3>
                                <button id="view-history" class="text-xs text-primary hover:underline">查看历史</button>
                            </div>
                            <div class="h-40 bg-gray-50 rounded-md" id="spectra-result">
                                <canvas id="spectraChart" class="w-full h-full"></canvas>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="font-medium">分析结果</h3>
                                <span class="text-xs bg-green-100 text-success px-2 py-0.5 rounded-full">已完成</span>
                            </div>
                            
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">反应程度:</span>
                                    <span class="font-medium">35%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">峰值波长:</span>
                                    <span class="font-medium">527 nm</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">浓度估算:</span>
                                    <span class="font-medium">0.32 mg/mL</span>
                                </div>
                                <div class="mt-3 pt-3 border-t border-gray-200">
                                    <p class="text-xs text-gray-500 mb-1">结果判定:</p>
                                    <p class="text-sm">反应正常进行中，建议继续监测。预计还需10分钟达到稳定状态。</p>
                                </div>
                            </div>
                            
                            <button id="generate-report" class="w-full mt-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors text-sm">
                                <i class="fa fa-file-text-o mr-1"></i>生成详细报告
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- 模态框 - 确认操作 -->
    <div id="confirm-modal" class="modal-backdrop hidden">
        <div class="modal">
            <h3 class="text-lg font-semibold mb-3" id="modal-title">确认操作</h3>
            <p class="text-gray-600 mb-4" id="modal-message">您确定要执行此操作吗？</p>
            <div class="flex space-x-3">
                <button id="modal-cancel" class="flex-1 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">取消</button>
                <button id="modal-confirm" class="flex-1 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors">确认</button>
            </div>
        </div>
    </div>

    <!-- 通知组件 -->
    <div id="notification" class="notification bg-white shadow-lg">
        <div class="flex items-center">
            <i id="notification-icon" class="fa fa-check-circle text-success mr-2"></i>
            <div>
                <p id="notification-title" class="font-medium"></p>
                <p id="notification-message" class="text-sm text-gray-600"></p>
            </div>
            <button id="close-notification" class="ml-auto text-gray-400 hover:text-gray-600">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // 全局状态管理
        const appState = {
            pumps: {
                1: { running: false, flow: 50, time: 10 },
                2: { running: false, flow: 30, time: 15 },
                3: { running: false, flow: 40, time: 20 }
            },
            valves: {
                1: 'open',
                2: 'close',
                3: 'close',
                4: 'open',
                5: 'close',
                6: 'close'
            },
            experiment: {
                currentStep: 2,
                totalSteps: 5,
                progress: 35,
                remainingTime: '9分钟'
            },
            deviceStatus: {
                pumpSystem: 'normal',
                detectionSystem: 'normal',
                currentTask: 'running'
            }
        };

        // 初始化实时数据图表
        const initRealtimeChart = () => {
            const ctx = document.getElementById('realtimeChart').getContext('2d');
            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 20}, (_, i) => i),
                    datasets: [{
                        label: '吸光度 (527nm)',
                        data: [0.12, 0.15, 0.18, 0.21, 0.25, 0.28, 0.31, 0.34, 0.37, 0.40, 0.42, 0.45, 0.47, 0.49, 0.51, 0.53, 0.55, 0.56, 0.57, 0.58],
                        borderColor: '#165DFF',
                        backgroundColor: 'rgba(22, 93, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    size: 10
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 10
                                }
                            }
                        }
                    }
                }
            });
        };

        // 初始化光谱结果图表
        const initSpectraChart = () => {
            const ctx = document.getElementById('spectraChart').getContext('2d');
            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 31}, (_, i) => 400 + i * 10),
                    datasets: [{
                        label: '吸光度',
                        data: [0.1, 0.12, 0.15, 0.18, 0.22, 0.25, 0.28, 0.32, 0.35, 0.39, 0.42, 0.45, 0.48, 0.52, 0.55, 0.58, 0.62, 0.65, 0.68, 0.65, 0.62, 0.58, 0.55, 0.52, 0.48, 0.45, 0.42, 0.38, 0.35, 0.32, 0.3],
                        borderColor: '#36CFC9',
                        backgroundColor: 'rgba(54, 207, 201, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '吸光度',
                                font: {
                                    size: 10
                                }
                            },
                            ticks: {
                                font: {
                                    size: 8
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '波长 (nm)',
                                font: {
                                    size: 10
                                }
                            },
                            ticks: {
                                font: {
                                    size: 8
                                },
                                maxTicksLimit: 8
                            }
                        }
                    }
                }
            });
        };

        // 显示通知
        const showNotification = (title, message, type = 'success') => {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notification-title');
            const notificationMessage = document.getElementById('notification-message');
            const notificationIcon = document.getElementById('notification-icon');

            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            // 设置图标和颜色
            notificationIcon.className = '';
            if (type === 'success') {
                notificationIcon.className = 'fa fa-check-circle text-success mr-2';
                notification.classList.add('border-l-4', 'border-success');
            } else if (type === 'error') {
                notificationIcon.className = 'fa fa-exclamation-circle text-danger mr-2';
                notification.classList.add('border-l-4', 'border-danger');
            } else if (type === 'warning') {
                notificationIcon.className = 'fa fa-exclamation-triangle text-warning mr-2';
                notification.classList.add('border-l-4', 'border-warning');
            } else if (type === 'info') {
                notificationIcon.className = 'fa fa-info-circle text-primary mr-2';
                notification.classList.add('border-l-4', 'border-primary');
            }

            // 显示通知
            notification.classList.remove('translate-x-full');
            
            // 3秒后自动关闭
            setTimeout(() => {
                hideNotification();
            }, 3000);
        };

        // 隐藏通知
        const hideNotification = () => {
            const notification = document.getElementById('notification');
            notification.classList.add('translate-x-full');
            
            // 清除样式
            notification.className = 'notification bg-white shadow-lg';
        };

        // 显示确认对话框
        const showConfirmModal = (title, message, confirmCallback) => {
            const modal = document.getElementById('confirm-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalConfirm = document.getElementById('modal-confirm');
            const modalCancel = document.getElementById('modal-cancel');

            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modal.classList.remove('hidden');

            // 确认按钮事件
            const handleConfirm = () => {
                confirmCallback();
                modal.classList.add('hidden');
                modalConfirm.removeEventListener('click', handleConfirm);
                modalCancel.removeEventListener('click', handleCancel);
            };

            // 取消按钮事件
            const handleCancel = () => {
                modal.classList.add('hidden');
                modalConfirm.removeEventListener('click', handleConfirm);
                modalCancel.removeEventListener('click', handleCancel);
            };

            modalConfirm.addEventListener('click', handleConfirm);
            modalCancel.addEventListener('click', handleCancel);
        };

        // 更新泵状态
        const updatePumpStatus = (pumpId, running) => {
            appState.pumps[pumpId].running = running;
            
            const pumpStatus = document.getElementById(`pump-${pumpId}-status`);
            const startBtn = document.querySelector(`.pump-start[data-pump="${pumpId}"]`);
            const stopBtn = document.querySelector(`.pump-stop[data-pump="${pumpId}"]`);
            
            if (running) {
                pumpStatus.innerHTML = '<span class="status-indicator bg-warning animate-pulse"></span>运行中';
                pumpStatus.className = 'flex items-center text-warning text-sm';
                startBtn.disabled = true;
                startBtn.classList.add('bg-gray-400');
                startBtn.classList.remove('bg-primary');
                stopBtn.disabled = false;
                stopBtn.classList.remove('bg-gray-500');
                stopBtn.classList.add('bg-danger');
                
                // 记录日志
                const flow = appState.pumps[pumpId].flow;
                const time = appState.pumps[pumpId].time;
                addSystemLog(`泵${pumpId}启动: ${flow}μL/min, ${time}秒`);
            } else {
                pumpStatus.innerHTML = '<span class="status-indicator bg-success"></span>就绪';
                pumpStatus.className = 'flex items-center text-success text-sm';
                startBtn.disabled = false;
                startBtn.classList.remove('bg-gray-400');
                startBtn.classList.add('bg-primary');
                stopBtn.disabled = true;
                stopBtn.classList.add('bg-gray-500');
                stopBtn.classList.remove('bg-danger');
                
                // 记录日志
                addSystemLog(`泵${pumpId}已停止`);
            }
        };

        // 更新阀门状态
        const updateValveStatus = (valveId, state) => {
            appState.valves[valveId] = state;
            
            const valveControl = document.querySelector(`.valve-control[data-valve="${valveId}"]`);
            const openBtn = valveControl.querySelector('.valve-toggle[data-state="open"]');
            const closeBtn = valveControl.querySelector('.valve-toggle[data-state="close"]');
            
            if (state === 'open') {
                openBtn.className = 'px-3 py-1 bg-success text-white text-xs rounded valve-toggle';
                closeBtn.className = 'px-3 py-1 bg-gray-200 text-gray-700 text-xs rounded valve-toggle';
                addSystemLog(`阀门${valveId}已打开`);
            } else {
                openBtn.className = 'px-3 py-1 bg-gray-200 text-gray-700 text-xs rounded valve-toggle';
                closeBtn.className = 'px-3 py-1 bg-danger text-white text-xs rounded valve-toggle';
                addSystemLog(`阀门${valveId}已关闭`);
            }
        };

        // 添加系统日志
        const addSystemLog = (message) => {
            const logContainer = document.getElementById('system-log');
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            const logEntry = document.createElement('p');
            logEntry.innerHTML = `<span class="text-gray-400">[${timeString}]</span> ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight; // 滚动到底部
        };

        // 更新实验进度
        const updateExperimentProgress = (progress, step, remainingTime) => {
            appState.experiment.progress = progress;
            appState.experiment.currentStep = step;
            appState.experiment.remainingTime = remainingTime;
            
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('current-step').textContent = `步骤${step}/${appState.experiment.totalSteps}`;
            document.getElementById('remaining-time').textContent = `预计剩余: ${remainingTime}`;
        };

        // 模拟图像捕获
        const simulateImageCapture = () => {
            const placeholder = document.getElementById('preview-placeholder');
            const image = document.getElementById('preview-image');
            
            // 显示加载状态
            placeholder.textContent = '正在捕获图像...';
            
            // 模拟延迟
            setTimeout(() => {
                // 使用随机图像模拟捕获的图像
                image.src = `https://picsum.photos/seed/${Math.random()}/300/200`;
                image.alt = '微流控芯片反应图像';
                image.classList.remove('hidden');
                placeholder.classList.add('hidden');
                
                showNotification('图像捕获成功', '已成功获取反应区域图像', 'success');
                addSystemLog('成像检测完成，已捕获反应区域图像');
            }, 1500);
        };

        // 初始化事件监听
        const initEventListeners = () => {
            // 泵控制按钮
            document.querySelectorAll('.pump-start').forEach(btn => {
                btn.addEventListener('click', function() {
                    const pumpId = this.getAttribute('data-pump');
                    const flow = parseInt(document.getElementById(`pump-${pumpId}-flow`).value);
                    const time = parseInt(document.getElementById(`pump-${pumpId}-time`).value);
                    
                    // 验证参数
                    if (flow <= 0 || flow > 1000) {
                        showNotification('参数错误', '流量必须在1-1000 μL/min之间', 'error');
                        return;
                    }
                    
                    if (time <= 0 || time > 3600) {
                        showNotification('参数错误', '时间必须在1-3600秒之间', 'error');
                        return;
                    }
                    
                    // 更新状态
                    appState.pumps[pumpId].flow = flow;
                    appState.pumps[pumpId].time = time;
                    
                    // 显示确认对话框
                    showConfirmModal(
                        '启动泵', 
                        `确定要启动泵${pumpId}吗？\n流量: ${flow}μL/min, 时间: ${time}秒`,
                        () => {
                            updatePumpStatus(pumpId, true);
                            
                            // 模拟泵自动停止
                            setTimeout(() => {
                                if (appState.pumps[pumpId].running) {
                                    updatePumpStatus(pumpId, false);
                                }
                            }, time * 1000);
                        }
                    );
                });
                
                // 添加按钮点击效果
                btn.addEventListener('mousedown', () => btn.classList.add('btn-active'));
                btn.addEventListener('mouseup', () => btn.classList.remove('btn-active'));
                btn.addEventListener('mouseleave', () => btn.classList.remove('btn-active'));
            });
            
            // 泵停止按钮
            document.querySelectorAll('.pump-stop').forEach(btn => {
                btn.addEventListener('click', function() {
                    const pumpId = this.getAttribute('data-pump');
                    showConfirmModal(
                        '停止泵', 
                        `确定要停止泵${pumpId}吗？`,
                        () => updatePumpStatus(pumpId, false)
                    );
                });
                
                // 添加按钮点击效果
                btn.addEventListener('mousedown', () => btn.classList.add('btn-active'));
                btn.addEventListener('mouseup', () => btn.classList.remove('btn-active'));
                btn.addEventListener('mouseleave', () => btn.classList.remove('btn-active'));
            });
            
            // 阀门控制按钮
            document.querySelectorAll('.valve-toggle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const valveId = this.closest('.valve-control').getAttribute('data-valve');
                    const state = this.getAttribute('data-state');
                    
                    // 如果已经是目标状态，则不执行操作
                    if (appState.valves[valveId] === state) return;
                    
                    updateValveStatus(valveId, state);
                });
                
                // 添加按钮点击效果
                btn.addEventListener('mousedown', () => btn.classList.add('btn-active'));
                btn.addEventListener('mouseup', () => btn.classList.remove('btn-active'));
                btn.addEventListener('mouseleave', () => btn.classList.remove('btn-active'));
            });
            
            // 光谱检测按钮
            document.getElementById('start-spectra').addEventListener('click', function() {
                const start = parseInt(document.getElementById('spectra-start').value);
                const end = parseInt(document.getElementById('spectra-end').value);
                const interval = parseInt(document.getElementById('spectra-interval').value);
                const mode = document.getElementById('spectra-mode').value;
                
                // 验证参数
                if (start >= end || start < 300 || end > 1000) {
                    showNotification('参数错误', '波长范围设置不正确', 'error');
                    return;
                }
                
                if (interval <= 0 || interval > 300) {
                    showNotification('参数错误', '检测间隔必须在1-300秒之间', 'error');
                    return;
                }
                
                showConfirmModal(
                    '开始光谱检测', 
                    `确定要开始光谱检测吗？\n范围: ${start}-${end}nm, 模式: ${mode}, 间隔: ${interval}s`,
                    () => {
                        this.disabled = true;
                        this.classList.add('bg-gray-400');
                        this.classList.remove('bg-secondary');
                        
                        addSystemLog(`开始光谱检测: ${start}-${end}nm, ${mode}模式`);
                        showNotification('光谱检测已启动', '正在进行光谱数据采集', 'info');
                        
                        // 模拟检测完成
                        setTimeout(() => {
                            this.disabled = false;
                            this.classList.remove('bg-gray-400');
                            this.classList.add('bg-secondary');
                            
                            addSystemLog('光谱检测完成');
                            showNotification('光谱检测完成', '已成功获取光谱数据', 'success');
                        }, 3000);
                    }
                );
            });
            
            // 成像检测按钮
            document.getElementById('capture-image').addEventListener('click', function() {
                const exposure = document.getElementById('camera-exposure').value;
                const magnification = document.getElementById('camera-magnification').value;
                
                showConfirmModal(
                    '捕获图像', 
                    `确定要捕获图像吗？\n曝光时间: ${exposure}ms, 放大倍数: ${magnification}`,
                    () => {
                        addSystemLog(`开始成像检测: ${magnification}, ${exposure}ms曝光`);
                        simulateImageCapture();
                    }
                );
            });
            
            // 运行流程按钮
            document.getElementById('run-process').addEventListener('click', function() {
                showConfirmModal(
                    '运行实验流程', 
                    '确定要开始执行当前实验流程吗？\n这将按顺序执行所有步骤。',
                    () => {
                        addSystemLog('开始执行实验流程: 蛋白反应检测');
                        showNotification('实验流程已启动', '正在按顺序执行实验步骤', 'info');
                        
                        // 模拟流程进度更新
                        let progress = 35;
                        let step = 2;
                        const interval = setInterval(() => {
                            progress += 1;
                            if (progress >= 100) {
                                progress = 100;
                                step = 5;
                                clearInterval(interval);
                                addSystemLog('实验流程执行完成');
                                showNotification('实验流程已完成', '所有步骤已成功执行', 'success');
                            } else if (progress >= 60) {
                                step = 3;
                            } else if (progress >= 80) {
                                step = 4;
                            }
                            
                            updateExperimentProgress(progress, step, `${Math.max(0, 9 - Math.floor(progress/10))}分钟`);
                        }, 3000);
                    }
                );
            });
            
            // 添加步骤按钮
            document.getElementById('add-step').addEventListener('click', function() {
                showNotification('功能开发中', '步骤添加功能即将上线', 'info');
            });
            
            // 编辑步骤按钮
            document.querySelectorAll('.edit-step').forEach(btn => {
                btn.addEventListener('click', function() {
                    const stepId = this.getAttribute('data-step');
                    showNotification('功能开发中', `编辑步骤 ${stepId} 功能即将上线`, 'info');
                });
            });
            
            // 删除步骤按钮
            document.querySelectorAll('.delete-step').forEach(btn => {
                btn.addEventListener('click', function() {
                    const stepId = this.getAttribute('data-step');
                    showConfirmModal(
                        '删除步骤', 
                        `确定要删除步骤 ${stepId} 吗？`,
                        () => {
                            this.closest('div').remove();
                            addSystemLog(`已删除实验流程步骤 ${stepId}`);
                            showNotification('步骤已删除', `步骤 ${stepId} 已从流程中移除`, 'info');
                        }
                    );
                });
            });
            
            // 保存流程按钮
            document.getElementById('save-process').addEventListener('click', function() {
                showNotification('流程已保存', '当前实验流程已成功保存', 'success');
                addSystemLog('实验流程已保存: 蛋白反应检测');
            });
            
            // 加载流程按钮
            document.getElementById('load-process').addEventListener('click', function() {
                showNotification('功能开发中', '加载流程功能即将上线', 'info');
            });
            
            // 查看历史按钮
            document.getElementById('view-history').addEventListener('click', function() {
                showNotification('功能开发中', '历史数据查看功能即将上线', 'info');
            });
            
            // 生成报告按钮
            document.getElementById('generate-report').addEventListener('click', function() {
                showNotification('报告生成中', '正在生成实验报告...', 'info');
                
                // 模拟报告生成
                setTimeout(() => {
                    showNotification('报告已生成', '实验详细报告已成功生成', 'success');
                    addSystemLog('实验报告生成完成');
                }, 2000);
            });
            
            // 预设通路模式按钮
            document.getElementById('preset-paths').addEventListener('click', function() {
                showConfirmModal(
                    '应用预设通路', 
                    '确定要应用预设通路模式吗？这将自动调整所有阀门状态。',
                    () => {
                        // 模拟预设通路模式
                        updateValveStatus(1, 'open');
                        updateValveStatus(2, 'close');
                        updateValveStatus(3, 'close');
                        updateValveStatus(4, 'open');
                        updateValveStatus(5, 'close');
                        updateValveStatus(6, 'close');
                        
                        addSystemLog('已应用预设通路模式: 标准检测模式');
                        showNotification('预设已应用', '标准检测通路模式已启用', 'success');
                    }
                );
            });
            
            // 紧急停止按钮
            document.getElementById('emergency-stop').addEventListener('click', function() {
                showConfirmModal(
                    '紧急停止', 
                    '确定要执行紧急停止吗？这将立即停止所有设备运行！',
                    () => {
                        // 停止所有泵
                        for (let i = 1; i <= 3; i++) {
                            if (appState.pumps[i].running) {
                                updatePumpStatus(i, false);
                            }
                        }
                        
                        addSystemLog('系统紧急停止已执行');
                        showNotification('紧急停止已执行', '所有设备已停止运行', 'warning');
                    }
                );
            });
            
            // 关闭通知按钮
            document.getElementById('close-notification').addEventListener('click', hideNotification);
            
            // 参数输入变化时更新状态
            document.querySelectorAll('.parameter-input').forEach(input => {
                input.addEventListener('change', function() {
                    const pumpId = this.id.split('-')[1];
                    if (this.id.includes('pump') && pumpId) {
                        if (this.id.includes('flow')) {
                            appState.pumps[pumpId].flow = parseInt(this.value);
                        } else if (this.id.includes('time')) {
                            appState.pumps[pumpId].time = parseInt(this.value);
                        }
                    }
                });
            });
        };

        // 模拟实时数据更新
        const startRealtimeUpdates = (chart) => {
            setInterval(() => {
                // 更新时间戳
                const now = new Date();
                document.getElementById('last-update').textContent = now.toLocaleString();
                
                // 更新图表数据
                chart.data.datasets[0].data.shift();
                const lastValue = chart.data.datasets[0].data[chart.data.datasets[0].data.length - 1];
                const newValue = Math.max(0, lastValue + (Math.random() * 0.02 - 0.005)); // 小幅度随机波动
                chart.data.datasets[0].data.push(newValue);
                chart.update();
            }, 5000);
        };

        // 初始化应用
        const initApp = () => {
            const realtimeChart = initRealtimeChart();
            initSpectraChart();
            initEventListeners();
            startRealtimeUpdates(realtimeChart);
            
            // 显示初始化完成通知
            setTimeout(() => {
                showNotification('系统已就绪', '微流控测试平台控制软件启动完成', 'success');
            }, 1000);
        };

        // 启动应用
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
    